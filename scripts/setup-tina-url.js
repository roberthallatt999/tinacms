#!/usr/bin/env node

/**
 * Script to set up proper TinaCMS dev server URL configuration
 * This creates a .env.development file with the TINA_PUBLIC_URL variable
 */

const fs = require('fs');
const path = require('path');
const readline = require('readline');

// Default URL for local development
const DEFAULT_URL = 'http://localhost:3000';

// Create readline interface for user input
const rl = readline.createInterface({
  input: process.stdin,
  output: process.stdout
});

console.log('ü¶ô TinaCMS URL Configuration Setup\n');

// Ask the user for their development URL or use the default
rl.question(`Enter your development URL (default: ${DEFAULT_URL}): `, (url) => {
  // Use default if empty
  const devUrl = url.trim() || DEFAULT_URL;
  
  // Create .env.development content
  const envContent = `# TinaCMS Development Configuration
# This file is auto-generated by scripts/setup-tina-url.js
# It configures the TinaCMS dev server URL display

# The URL where your Next.js app is running - used for TinaCMS UI links
TINA_PUBLIC_URL=${devUrl}

# This is used by GitHub OAuth and TinaCMS
NEXT_PUBLIC_APP_URL=${devUrl}
`;

  // Write to .env.development file
  const envPath = path.join(__dirname, '..', '.env.development');
  
  try {
    fs.writeFileSync(envPath, envContent);
    console.log(`\n‚úÖ Successfully created .env.development with TINA_PUBLIC_URL=${devUrl}`);
    console.log('\nüöÄ Next steps:');
    console.log('1. Restart your TinaCMS dev server');
    console.log('2. The correct URL should now appear in the dev server output');
  } catch (error) {
    console.error('\n‚ùå Error creating .env.development file:', error.message);
  }
  
  rl.close();
});
